<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>For My Love ‚Äî Sinh nh·∫≠t & 20/11 ‚ù§Ô∏è</title>

<link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">

<style>
  :root{
    --heart-left-pct: 2;
    --heart-top-pct: 12;
    --heart-width-pct: 46;
    --heart-height-pct: 56;
    --piece-size: 70px;
    --slidesize: 300px;
  }

  html,body{
    height:100%;
    margin:0;
    font-family:'Quicksand',sans-serif;
    background:#faf6f6;
    overflow:hidden;
    color:#222;
  }

  #bg{
    position:fixed;
    inset:0;
    background-size:cover;
    background-position:center;
    filter:blur(14px) brightness(.7);
    transform:scale(1.05);
    z-index:-4;
    transition:background-image .1s ease;
  }

  #veil{
    position:fixed;
    inset:0;
    z-index:-3;
    background:rgba(255,255,255,0.06);
    transition:background .35s ease;
  }

  #finalOverlay{
    position:fixed;
    inset:0;
    z-index:-2;
    pointer-events:none;
    transition:background .6s ease;
  }

  .particle{
    position:fixed;
    top:-10vh;
    pointer-events:none;
    z-index:7;
    opacity:.9;
    will-change:transform
  }
  .p-small{width:8px;height:8px}
  .p-mid{width:14px;height:14px}
  .p-large{width:18px;height:18px}
  @keyframes floatDown{to{transform:translateY(120vh) rotate(360deg);opacity:.25}}

  #scene{position:fixed;inset:0;perspective:1400px;z-index:1}

  #cardClosed{
    position:absolute;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    width:340px;
    cursor:pointer;
    z-index:30;
    transition:transform .9s cubic-bezier(.2,.9,.2,1),opacity .6s;
  }

  #openBtn{
    position:absolute;
    left:50%;
    top:calc(50% + 180px);
    transform:translateX(-50%);
    font-size:48px;
    z-index:31;
    color:#ff4d6d;
    cursor:pointer;
    text-shadow:0 0 12px #ffa3b1;
    animation:btnPulse 1.3s infinite;
  }
  @keyframes btnPulse{
    0%,100%{transform:translateX(-50%) scale(1)}
    50%{transform:translateX(-50%) scale(1.25)}
  }

  #panel{
    position:fixed;
    right:2%;
    top:50%;
    transform:translateY(-50%);
    width:420px;
    border-radius:18px;
    background:rgba(255,255,255,0.95);
    box-shadow:0 20px 50px rgba(0,0,0,0.18);
    padding:28px;
    z-index:28;
    opacity:0;
    transition:all .9s ease
  }
  #panel h1{
    font-family:'Pacifico',cursive;
    color:#c83a63;
    margin:0 0 12px;
    font-size:26px
  }
  #panel p{
    color:#333;
    line-height:1.6;
    font-size:15px;
    margin:0;
  }

  .slide{
    position:absolute;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%) rotateY(-120deg);
    width:var(--slidesize);
    border-radius:16px;
    box-shadow:0 12px 40px rgba(0,0,0,0.35);
    opacity:0;
    z-index:26;
    backface-visibility:hidden;
    transition:transform .7s ease,opacity .6s;
  }

  @keyframes flipIn {
    0% { transform: translate(-50%,-50%) rotateY(-140deg) scale(.95); opacity:0 }
    60% { transform: translate(-50%,-50%) rotateY(8deg) scale(1.02); opacity:1 }
    100% { transform: translate(-50%,-50%) rotateY(0deg) scale(1); opacity:1 }
  }

  .heartPiece{
    position:absolute;
    width:var(--piece-size);
    height:var(--piece-size);
    object-fit:cover;
    border-radius:14px;
    box-shadow:0 8px 20px rgba(0,0,0,0.25);
    transform:translate(-50%,-50%) scale(1);
    transition:all 900ms cubic-bezier(.2,.9,.2,1);
    opacity:0;
    z-index:22;
    pointer-events:none;
  }

  /* ‚ù§Ô∏è Th√™m hi·ªáu ·ª©ng nh·ªãp tim to√†n b·ªô tr√°i tim */
  @keyframes heartBeat {
    0%   { transform: scale(1); }
    25%  { transform: scale(1.05); }
    50%  { transform: scale(1); }
    75%  { transform: scale(1.06); }
    100% { transform: scale(1); }
  }

  #heartContainer{
    position:absolute;
    left:0;
    top:0;
    width:100%;
    height:100%;
    transform-origin:center;
  }

  .hand{
    font-family:'Pacifico',cursive;
    font-size:20px;
    color:#be2f59;
    line-height:1.6;
    opacity:0;
    transform:translateY(14px);
    transition:all .6s ease;
  }

</style>
</head>

<body>

<div id="bg"></div>
<div id="veil"></div>
<div id="finalOverlay"></div>
<div id="particleRoot"></div>

<div id="scene">
  <img id="cardClosed" src="card-closed.png">
  <div id="openBtn">‚ù§Ô∏è</div>
</div>

<div id="slidesRoot"></div>
<div id="heartRoot"></div>

<div id="panel">
  <h1>G·ª≠i em ‚Äî ng∆∞·ªùi anh y√™u</h1>
  <p class="hand" id="line1">Ch√∫c m·ª´ng sinh nh·∫≠t v√† 20/11 c·ªßa c√¥ g√°i xinh ƒë·∫πp nh·∫•t trong l√≤ng anh‚Ä¶</p>
  <p class="hand" id="line2">C·∫£m ∆°n em v√¨ ƒë√£ lu√¥n d·ªãu d√†ng, lu√¥n cho anh c·∫£m gi√°c b√¨nh y√™n m√† kh√¥ng n∆°i n√†o c√≥ ƒë∆∞·ª£c‚Ä¶</p>
  <p class="hand" id="line3">C·∫£m ∆°n em ƒë√£ l√† gi√°o vi√™n, l√† b·∫°n th√¢n, l√† ng∆∞·ªùi y√™u ‚Äì l√† c·∫£ th·∫ø gi·ªõi c·ªßa anh üíï</p>
  <p class="hand" id="line4">Ch√∫c em ƒÉn ngon, ng·ªß k·ªπ, c∆∞·ªùi nhi·ªÅu, v√† lu√¥n ch·ªãu ‚Äòch·ªãu ƒë·ª±ng‚Äô anh/em m·ªôt c√°ch d·ªÖ th∆∞∆°ng üòù</p>
  <p class="hand" id="line5">Ch√∫c em m√£i r·∫°ng r·ª°, h·∫°nh ph√∫c v√† ƒë∆∞·ª£c y√™u th∆∞∆°ng theo ƒë√∫ng c√°ch em x·ª©ng ƒë√°ng.</p>
  <p class="hand" id="line6">Anh y√™u em r·∫•t nhi·ªÅu ‚ù§Ô∏è</p>
</div>

<audio id="music" src="music.mp3" preload="auto"></audio>

<script>
const MAX_PICS = 73;
const SLIDE_MS = 1500;
const PIECE_SIZE = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--piece-size')) || 70;

function preloadPhotoList(n, cb){
  const imgs=[]; let loaded=0;
  for(let i=1;i<=n;i++){
    const path = `img/photo${i}.jpg`;
    const im = new Image();
    im.onload = ()=>{ imgs.push(path); done(); };
    im.onerror = ()=>{ done(); };
    im.src = path;
  }
  function done(){ loaded++; if(loaded===n) cb(imgs); }
}

preloadPhotoList(MAX_PICS, list=>{
  const use = list.slice(0, MAX_PICS);
  if(use.length===0){ alert("Kh√¥ng c√≥ ·∫£nh photo1.jpg..."); return; }
  init(use);
});

function init(photos){
  const used = photos.slice(0, MAX_PICS);

  document.getElementById('bg').style.backgroundImage = `url('${used[0]}')`;
  createParticles();

  const openBtn = document.getElementById('openBtn');
  const cardClosed = document.getElementById('cardClosed');
  const music = document.getElementById('music');

  openBtn.onclick = async ()=>{
    try{ await music.play(); }catch(e){}
    openBtn.style.opacity = 0;

    cardClosed.style.transform = "translate(-50%,-50%) rotateY(140deg) scale(.55)";
    cardClosed.style.opacity = 0;

    setTimeout(()=>{
      cardClosed.remove();
      openBtn.remove();
      startSequence(used);
    }, 900);
  };
}

function createParticles(){
  const root = document.getElementById('particleRoot');
  const snow=16, petal=18, glitter=36;

  function add(text,sizeClass,dur){
    const d=document.createElement('div');
    d.className='particle '+sizeClass;
    if(text) d.textContent=text;
    d.style.left=Math.random()*100+'vw';
    d.style.top=(-10-Math.random()*20)+'vh';
    d.style.animation=`floatDown ${dur}ms linear ${Math.random()*2000}ms infinite`;
    root.appendChild(d);
  }

  for(let i=0;i<snow;i++) add("‚ùÑÔ∏è","p-small",5000+Math.random()*8000);
  for(let i=0;i<petal;i++){
    const d=document.createElement("div");
    d.className="particle p-mid";
    d.style.background=`center/contain no-repeat url('flower.png')`;
    d.style.left=Math.random()*100+'vw';
    d.style.top=(-10-Math.random()*20)+'vh';
    d.style.animation=`floatDown ${5000+Math.random()*7000}ms linear ${Math.random()*2000}ms infinite`;
    root.appendChild(d);
  }
  for(let i=0;i<glitter;i++) add("‚ú®","p-small",3800+Math.random()*5200);
}

async function startSequence(photos){
  const slidesRoot = document.getElementById('slidesRoot');
  const usedPhotos = [];

  for(let i=0;i<photos.length;i++){
    const src = photos[i];
    const el = document.createElement('img');
    el.src = src; el.className = 'slide';
    slidesRoot.appendChild(el);

    el.style.animation='none'; void el.offsetWidth;
    el.style.animation='flipIn .7s ease forwards';
    el.style.opacity = 1;

    document.getElementById('bg').style.backgroundImage = `url('${src}')`;
    document.getElementById('veil').style.background='rgba(255,255,255,0.36)';

    usedPhotos.push(src);

    await wait(SLIDE_MS);
    el.style.opacity=0;
    setTimeout(()=>el.remove(),600);

    document.getElementById('veil').style.background='rgba(255,255,255,0.14)';
    await wait(200);
  }

  finalizeHeart(usedPhotos);
}

function wait(ms){ return new Promise(res=>setTimeout(res,ms)); }

function finalizeHeart(usedPhotos){

  const heartMatrix = [
    [0,0,1,1,0,0,0,0,0,1,1,0,0], 
    [0,1,1,1,1,0,0,0,1,1,1,1,0], 
    [1,1,1,1,1,1,0,1,1,1,1,1,1], 
    [1,1,1,1,1,1,1,1,1,1,1,1,1],
    [0,1,1,1,1,1,1,1,1,1,1,1,0], 
    [0,0,1,1,1,1,1,1,1,1,1,0,0], 
    [0,0,0,1,1,1,1,1,1,1,0,0,0], 
    [0,0,0,0,1,1,1,1,1,0,0,0,0], 
    [0,0,0,0,0,1,1,1,0,0,0,0,0], 
    [0,0,0,0,0,0,1,0,0,0,0,0,0]
  ];

  const rows = heartMatrix.length;
  const cols = heartMatrix[0].length;

  const vpW = innerWidth;
  const vpH = innerHeight;

  const baseLeft = vpW*(parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--heart-left-pct'))/100);
  const baseTop  = vpH*(parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--heart-top-pct'))/100);

  /* ‚≠ê T·∫†O CONTAINER CH·ª®A TR√ÅI TIM */
  const heartRoot = document.getElementById('heartRoot');
  const heartContainer = document.createElement('div');
  heartContainer.id = "heartContainer";
  heartRoot.appendChild(heartContainer);

  let imgIndex = 0;

  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      if(heartMatrix[r][c] === 1){
        if(imgIndex >= usedPhotos.length) continue;

        const leftPos = baseLeft + c*PIECE_SIZE + PIECE_SIZE/2;
        const topPos  = baseTop  + r*PIECE_SIZE + PIECE_SIZE/2;

        const img = document.createElement("img");
        img.src = usedPhotos[imgIndex];
        img.className = "heartPiece";
        img.style.left = leftPos + "px";
        img.style.top  = topPos  + "px";

        heartContainer.appendChild(img);

        /* cho t·ª´ng ·∫£nh fade-in */
        setTimeout(()=>{ img.style.opacity = 1; }, imgIndex * 80);

        imgIndex++;
      }
    }
  }

  /* ‚≠ê B·∫¨T NH·ªäP TIM CHO TO√ÄN B·ªò TR√ÅI TIM */
  setTimeout(()=>{
    heartContainer.style.animation = "heartBeat 1.8s ease-in-out infinite";
  }, 1600);

  /* HI·ªÜN L·ªúI NH·∫ÆN */
  setTimeout(()=>{
    document.getElementById('finalOverlay').style.background =
    'linear-gradient(120deg, rgba(255,230,240,0.55), rgba(230,245,255,0.55))';

    const panel=document.getElementById('panel');
    panel.style.opacity=1;

    const lines=document.querySelectorAll('.hand');
    lines.forEach((ln,idx)=>
      setTimeout(()=>{ ln.style.opacity=1; ln.style.transform='translateY(0)' }, 500+idx*450)
    );

    document.getElementById('veil').style.background='rgba(255,255,255,0.05)';
  }, 2200);
}

</script>
</body>
</html>
